/// <reference types="node" />
/// <reference types="ws" />
/// <reference types="node" />
/// <reference types="koa__router" />
import { Agent } from 'agent-base';
import net from 'net';
import { Context, Schema } from '@satorijs/core';
import { MaybeArray } from 'cosmokit';
import { IncomingMessage, Server } from 'http';
import WebSocket from 'ws';
import KoaRouter from '@koa/router';
type CreateAgent = (opts: string) => Agent;
export function register(protocols: string[], callback: CreateAgent): void;
export function getAgent(url: string): Agent;
export interface ListenOptions {
    host?: string;
    port?: number;
    maxPort?: number;
}
export function listen(server: net.Server, { host, port, maxPort }: ListenOptions): Promise<number>;
declare module 'koa' {
    interface Request {
        body?: any;
        rawBody?: string;
    }
}
declare module '@satorijs/core' {
    interface Context {
        router: Router;
    }
}
type WebSocketCallback = (socket: WebSocket, request: IncomingMessage) => void;
export class WebSocketLayer {
    private router;
    callback?: WebSocketCallback;
    clients: Set<WebSocket>;
    regexp: RegExp;
    constructor(router: Router, path: MaybeArray<string | RegExp>, callback?: WebSocketCallback);
    accept(socket: WebSocket, request: IncomingMessage): boolean;
    close(): void;
}
export class Router extends KoaRouter {
    _http?: Server;
    _ws?: WebSocket.Server;
    wsStack: WebSocketLayer[];
    constructor(ctx: Context);
    /**
     * hack into router methods to make sure that koa middlewares are disposable
     */
    register(...args: Parameters<KoaRouter['register']>): KoaRouter.Layer;
    ws(path: MaybeArray<string | RegExp>, callback?: WebSocketCallback): WebSocketLayer;
}
export * from '@satorijs/core';
export * from 'cosmokit';
declare module '@satorijs/core' {
    namespace Context {
        interface Config extends Config.Network {
        }
        namespace Config {
            interface Network {
                host?: string;
                port?: number;
                maxPort?: number;
                selfUrl?: string;
            }
            interface Static extends Schema<Config> {
                Network: Schema<Network>;
            }
        }
    }
}
